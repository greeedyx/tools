"use strict";var t=require("./tslib.es6-6a8d03eb.js"),n=require("./tools.js"),i=function(){function i(t){void 0===t&&(t=1),this._threadNum=1,this._totalCount=0,this._finishCount=0,this._taskArray=[],this.onFinishing=function(){return 0},this.onProcessing=function(){return 0},this.onErroring=function(){return 0},this._threadNum=t}return Object.defineProperty(i.prototype,"totalCount",{get:function(){return this._totalCount},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"finishCount",{get:function(){return this._finishCount},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"progress",{get:function(){return this.totalCount?(this.finishCount/this.totalCount).toFixed(2):0},enumerable:!1,configurable:!0}),i.prototype.add=function(t){return this._taskArray.push(t),this._totalCount++,this},i.prototype.addMany=function(t){var n=this;return t.forEach((function(t){return n.add(t)})),this},i.prototype.run=function(){var t=this,n=this.shiftElements(this._threadNum);Promise.all(n.map((function(n){return t.execute(n)}))).finally((function(){setTimeout((function(){var n;t._taskArray.length||null===(n=t.onFinishing)||void 0===n||n.call(t)}))}))},i.prototype.shiftElements=function(t){for(var n=[],i=0;i<t&&this._taskArray.length;i++){var r=this._taskArray.shift();n.push(r)}return n},i.prototype.execute=function(n){var i=this;return n?n().then((function(t){return setTimeout((function(){var n;null===(n=i.onProcessing)||void 0===n||n.call(i,t)}))})).catch((function(t){return setTimeout((function(){var n;null===(n=i.onErroring)||void 0===n||n.call(i,t)}))})).finally((function(){i._finishCount++;var n=t.__read(i.shiftElements(1),1)[0];return i.execute(n)})):Promise.resolve()},i.prototype.onFinish=function(t){return n.isFunction(t)&&(this.onFinishing=t),this},i.prototype.onProcess=function(t){return n.isFunction(t)&&(this.onProcessing=t),this},i.prototype.onError=function(t){return n.isFunction(t)&&(this.onErroring=t),this},i.prototype.reset=function(){return this._finishCount=0,this._totalCount=0,this._taskArray=[],this},i}();module.exports=i;
